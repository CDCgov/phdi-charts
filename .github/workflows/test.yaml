---
name: Test
on:
    workflow_call:
    workflow_dispatch:
    pull_request:
        branches:
            - "**"
    push:
        branches:
            - main

jobs:
    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3

            - name: Install yamllint
              run: pip install yamllint

            - name: Lint YAML files
              run: yamllint -c yaml_lint_configuration.yaml .
    unittests:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3
            - name: Run Helm tests
              run: |
                  find charts/*/templates/tests -name '*.yaml' -print0 | while IFS= read -r -d '' testfile; do
                  helm test "$testfile"
                  done
